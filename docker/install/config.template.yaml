# Apicurio Axiom Configuration - Docker Optimized
# This configuration uses environment variables for flexible deployment

# State Management
state:
  # Base path for state directory (database files)
  basePath: ${DATA_DIR}/state

# Logging Configuration
logging:
  # Log level: trace, debug, info, warn, error, fatal
  level: ${LOG_LEVEL}
  # Disable pretty printing in containers (use JSON for log aggregation)
  prettyPrint: false
  # Base path for action logs
  basePath: ${DATA_DIR}/logs
  # Path for event JSON logs
  eventsPath: ${DATA_DIR}/events
  # How many days to retain logs (30 days default)
  retentionDays: 30

# Work Directory Configuration
workDirectory:
  # Base path for work directories (git clones)
  basePath: ${DATA_DIR}/work
  # Maximum total size in GB
  maxSizeGB: 100
  # Start cleanup when size reaches this percentage of max
  cleanupThresholdPercent: 90
  # How often to check size and cleanup (seconds)
  monitorInterval: 3600

# GitHub API Configuration
github:
  # Personal Access Token from environment variable
  token: ${GITHUB_TOKEN}
  # Polling interval in seconds (how often to check for new events)
  pollInterval: 60
  # Ignore events that occurred before the application first started
  # Set to false if you want to process historical events
  ignoreEventsBeforeStart: true
  # Git clone depth for repository clones (1 = shallow, 0 = full)
  cloneDepth: 1

# Job Queue Configuration
queue:
  # Maximum number of concurrent actions to execute
  maxConcurrent: 3
  # How often to check the queue for pending jobs (seconds)
  pollInterval: 5

# Prompts Configuration
prompts:
  # Base path for Handlebars prompt templates
  basePath: ${APP_DIR}/prompts

# Google Cloud Vertex AI Configuration (for AI Agent actions)
vertexAI:
  # Project ID from environment variable
  projectId: ${ANTHROPIC_VERTEX_PROJECT_ID}
  # Region where Vertex AI is enabled
  region: us-east5
  # Claude model to use
  model: claude-sonnet-4-5@20250929
  # Safety limits for AI agent execution
  safety:
    # Maximum number of agent loop iterations
    maxSteps: 20
    # Maximum number of tool calls
    maxToolCalls: 50
    # Maximum total tokens
    maxTokens: 100000

# Repositories to Monitor
# Format: owner/repo
repositories:
  - Apicurio/apicurio-registry
  # Add more repositories as needed
  # - owner/repo-name

# Event Mappings
# Maps GitHub events to actions with optional filters
eventMappings:
  # Example: Auto-label new issues
  - event: issue.opened
    actions:
      - log-issue

  # Example: Analyze bugs when labeled
  - event: issue.labeled
    filters:
      - path: payload.label.name
        equals: bug
    actions:
      - log-label

# Action Definitions
actions:
  log-issue:
    type: shell
    command: |
      echo "Issue event detected:"
      echo "  Repository: $EVENT_REPOSITORY"
      echo "  Issue #$EVENT_ISSUE_NUMBER: $EVENT_ISSUE_TITLE"
      echo "  Author: $EVENT_ISSUE_AUTHOR"

  log-label:
    type: shell
    command: |
      echo "*** Issue has been labelled as a bug ***"
      echo "  Repository: $EVENT_REPOSITORY"
      echo "  Issue #$EVENT_ISSUE_NUMBER: $EVENT_ISSUE_TITLE"
      echo "  Author: $EVENT_ISSUE_AUTHOR"
